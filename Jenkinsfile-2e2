pipeline {
    agent {label 'windows'}
    stages {
        stage ("Clone") {
            steps {
                git "https://github.com/thanevil/WOG.git"
            }
        }
        stage ("Build and Run") {
            steps {
                script {
                bat '''
                docker build -t mainscore .
                docker run -d -p 8777:8777 --name web --mount source=score-data,target=/app mainscore'''
                }
            }
        }
        stage ("Test-Selenium") {
            steps {
                script {
                bat '''
                cd tests
                python e2e.py
                '''
                }
            }
        }
        stage ("Finalaizing") {
            steps {
                script {
                bat '''
                docker stop web
                docker tag mainscore thanevil/wog
                docker commit web thanevil/wog
                docker push thanevil/wog
                '''
                }
            }
        }

    }
}